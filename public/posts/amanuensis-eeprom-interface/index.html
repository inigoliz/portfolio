<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Minimalistic EEPROM programmer | Iñigo&#39;s Portfolio</title>
<meta name="keywords" content="">
<meta name="description" content="

What is it?
A command-line tool to interact with a 28c256 256KB EEPROM, which is the one used in
Ben Eater&rsquo;s 6502 pc.
Allows reading contents from the EEPROM and writing data to it.


Note: The command used to drive the EEPROM isnuensis. It is named after the Amanuensis monks, which provided services as scribes.

Check the project on Github to make your own!">
<meta name="author" content="">
<link rel="canonical" href="https://ignigoliz.github.io/portfolio/posts/amanuensis-eeprom-interface/">
<link crossorigin="anonymous" href="/portfolio/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ignigoliz.github.io/portfolio/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ignigoliz.github.io/portfolio/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ignigoliz.github.io/portfolio/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ignigoliz.github.io/portfolio/apple-touch-icon.png">
<link rel="mask-icon" href="https://ignigoliz.github.io/portfolio/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ignigoliz.github.io/portfolio/posts/amanuensis-eeprom-interface/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://ignigoliz.github.io/portfolio/posts/amanuensis-eeprom-interface/">
  <meta property="og:site_name" content="Iñigo&#39;s Portfolio">
  <meta property="og:title" content="Minimalistic EEPROM programmer">
  <meta property="og:description" content="
What is it? A command-line tool to interact with a 28c256 256KB EEPROM, which is the one used in Ben Eater’s 6502 pc. Allows reading contents from the EEPROM and writing data to it.
Note: The command used to drive the EEPROM isnuensis. It is named after the Amanuensis monks, which provided services as scribes.
Check the project on Github to make your own!">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-10T14:27:41+01:00">
    <meta property="article:modified_time" content="2024-12-10T14:27:41+01:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Minimalistic EEPROM programmer">
<meta name="twitter:description" content="

What is it?
A command-line tool to interact with a 28c256 256KB EEPROM, which is the one used in
Ben Eater&rsquo;s 6502 pc.
Allows reading contents from the EEPROM and writing data to it.


Note: The command used to drive the EEPROM isnuensis. It is named after the Amanuensis monks, which provided services as scribes.

Check the project on Github to make your own!">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ignigoliz.github.io/portfolio/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Minimalistic EEPROM programmer",
      "item": "https://ignigoliz.github.io/portfolio/posts/amanuensis-eeprom-interface/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Minimalistic EEPROM programmer",
  "name": "Minimalistic EEPROM programmer",
  "description": "\nWhat is it? A command-line tool to interact with a 28c256 256KB EEPROM, which is the one used in Ben Eater\u0026rsquo;s 6502 pc. Allows reading contents from the EEPROM and writing data to it.\nNote: The command used to drive the EEPROM isnuensis. It is named after the Amanuensis monks, which provided services as scribes.\nCheck the project on Github to make your own!\n",
  "keywords": [
    
  ],
  "articleBody": "\nWhat is it? A command-line tool to interact with a 28c256 256KB EEPROM, which is the one used in Ben Eater’s 6502 pc. Allows reading contents from the EEPROM and writing data to it.\nNote: The command used to drive the EEPROM isnuensis. It is named after the Amanuensis monks, which provided services as scribes.\nCheck the project on Github to make your own!\nMotivation Some years ago I went down the rabbit hole of building an 8-bit pc after getting inspired by Ben Eater’s Youtube videos. The goal was to learn computer microarchitecture and to demistify the transition from logic gates to an actual device that runs computations. It was very fun, and I plan to keep on playing with it in the near future.\nHowever, I found the interaction with the EEPROM (the memory of the 8-bit pc) quite rough. Ben Eater himself has a video explaining how to use an Arduino to write data to the EEPROM. Nonetheless, the Arduino code has to be changed and re-uploaded with every new content one wants to write to the EEPROM. I thought a Terminal-based interaction would make the experience so muuuuuch better. So, I decided to build it.\nNote: The core of the 8-bit pc is the 6502 microprocessor, a mythical chip that powered devices such as Apple II, NES, Commodore 64, and many others.\nIn particular, the reasons that make interacting with the EEPROM a painful process are the following:\nWith every new EEPROM data, the Arduino script has to be updated and re-uploaded. Likewise, when reading the EEPROM, selecting different addresses requires updating and re-uploading the Arduino code. The Arduino pins must be connected to the EEPROM’s pins thorugh 28 wires that have to be patiently and carefully placed. Also, repeatedly plugging in and out the EEPROM for writing can end up damaging the EEPROM’s pins. All this is annoying, specially considering that reading or writing the EEPROM is something that has to be done very frequently.\nMy solution:\nA CLI Tool to control the EEPROM using Terminal commands. One of the commands, nuensis write --file program.bin, writes a hexdump to the EEPROM. Other commands allow reading the EEPROM. To read a range of addresses, nuensis read --range 0000 003f, which reads addresses 0x000 to 0x003f. To read a single address, nuensis read --address 002f. The protoboard and the cables are replaced by a custom shield that is plugged directly into the Arduino Mega header. Rather than plugging the chip and progressively damaging the pins, a ZIF (Zero Insertion Force) connector grips the EEPROM with delicacy. How it Works The command parser for the Terminal runs in Python. Python communicates over the Serial Port with Arduino and sends what operation to perform. Arduino executes the low level electric pulses and register conigurations that eventually read/write the EEPROM.\nEach time a new command is submitted on the Terminal, a communication schema like the following takes place:\nI decided to implement an acknowledgment-based communication structure to make sure that data was sent and received correctly. After data is sent, the sender enters a halting state waiting for an acknowledgment (ACK) response. This applies to any sent data, except the ACK itself.\nBesides this basic structure, the code has several optimizations. For example, when reading data, Arduino does not transfer it in single values but in batches of 16 bytes.\nSerial Communication Python - Arduino I use the Python pyserial library, and the built-in Arduino Serial library. Using serial communication in Python is not difficult but it’s a bit slippery so I want to document the best practices I found.\nWhen dealing with the EEPROM, everything is best thought in terms of bytes. Memory addesses are 2 bytes long and each memory address stores data 1 byte long. Therefore, I need a way to send byte-level information between Python and Arduino.\nNote: 1 byte can store numbers in the range 0-255. Using hex encoding, a byte is represented using 2 hex numbers. 255 = 0xFF; 0 = 0x00; 58=0x3A. Likewise, 4 hex numbers represent 2 bytes of information.\n# PSEUDOCODE: The kind of communication desired: # Goal: Write data 0x00 to address 0x0407 package = [0x00, 0x04, 0x07] # Send data from Python to Arduino serial.send(package) # Arduino receives data and writes the EEPROM package = serial.read() data = package[0] address = combine(package[1], package[2]) eeprom.write(data, address) Note: I use Big Endian encoding: 0x0407 == [0x04, 0x07].\nHex Arithmetics in Arduino The Arduino programming language, which is based in C++, makes it easy to define byte-sized information:\nunsigned int address = 0x000f; byte data = 0xea; Note: byte is exclusively an Arduino datatype; it’s equivalent to char in C++, or std::byte in C++17.\nAlso, hex arithmetics behave intuitively in Arduino:\nunsigned int x = 0xabcd; // 0xABCD = 43981 x == 0xabcd; // True x == 43981; // True Hex Arithmetics in Python Things get more challenging in Python. Python being by default a non-typed language makes it confusing to work with byte-level data directly in hex.\nPython provides two classes to handle lists of byte data: bytes(), immutable; and bytearray(), mutable.\nFirst, some features about the bytes() class. An instance of such an object can be\na = b'\\xab' # 0xAB = 171 list(a) # prints [171] b = b'\\xab\\xcd' list(b) # prints [171, 205] So far so good. Feeling lucky. What will happen with the following…?\nc = list(b'\\xabcd') list(c) Let’s see… Ehm… OK. That made me wink. Why 3 elements?\nWell, it seems that Python, being string-o-centric, interprests the previous statement as “Create a list of byte information with the contents ‘0xab’, ‘c’, and ’d’”. Then, it uses ASCII encoding for ‘c’ (c = ASCII 99) and d (d = ASCII 100).\nWhy this behaviour? Well, it is because the bytes() object is not meant to behave nicely with HEX numbers. It is meant to store byte strings.\nI’d like to work with bytes() using a constructor like some_magic_constructor('abcd'). That way I could treat separately the bytes that compose an address, like some_magic_constructor('ab' + 'cd').\nFortunately, there is bytes.fromhex() that does just that. And .hex() prints a its content as a hex string:\na = bytes.fromhex('ab' + 'cd') a.hex() # prints 'abcd' The good thing about bytes() is that it allows list access to its elements. The bad thing is that it does not allow item assignment:\na = b'\\xab\\xcd' a[0] # prints 171 (0xab = 171) a[0] = b'\\xef' # TypeError: 'bytes' object does not support item assignment Fortunately, the class bytearray() behaves pretty much like bytes() but allows item assignment. It is instantiated by wrapping a bytes() object.\na = byetearray(b'\\xab\\xcd') b = bytearray.fromhex('ab' + 'cd') b[0] = bytes.fromhex('ef') # TypeError: 'bytes' object cannot be interpreted as an integer b[0] = 239 # 0xEF = 239 The only problem is that its elements cannot be assigned directly to bytes()- Weird!. But that’s a shortcoming I can live with.\nSending information over Serial Port The Python pyserial library makes it straigthforward sending byte information over the Serial Port to Arduino:\ndev = '/dev/' + os.popen(\"ls /dev/ | grep cu.usbmodem\").read().rstrip() port = serial.Serial(port=dev, baudrate=9600, timeout=0.1) packet = bytearray() packet += bytearray.fromhex('ab') packet += bytearray.fromhex('cd') port.write(packet) The Arduino is configured to just send back the data it receives:\n... void loop() { while (Serial.available() \u003e 0) { unsigned char incomingByte[1]; Serial.readBytes(incomingByte, 1); Serial.write(incomingByte, 1); } } The data that Arduino sends back gets stored in the serial buffer of the pc. Upon executing port.read(), the values are fetched one by one until the buffer is exhausted.\nThe Shield The shield simply connects certain Arduino Mega pins with certain EEPROM pins. The EEPROM is delicately held during programming using a ZIF connector (Zero Insertion Force). It also has a couple of LEDs for visual feedback.\nI ordered a custom PCB for my shield, but you can also make your own, as I did for the first prototype:\n",
  "wordCount" : "1317",
  "inLanguage": "en",
  "datePublished": "2024-12-10T14:27:41+01:00",
  "dateModified": "2024-12-10T14:27:41+01:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ignigoliz.github.io/portfolio/posts/amanuensis-eeprom-interface/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Iñigo's Portfolio",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ignigoliz.github.io/portfolio/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ignigoliz.github.io/portfolio/" accesskey="h" title="Iñigo&#39;s Portfolio (Alt + H)">Iñigo&#39;s Portfolio</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Minimalistic EEPROM programmer
    </h1>
    <div class="post-meta"><span title='2024-12-10 14:27:41 +0100 CET'>December 10, 2024</span>

</div>
  </header> 
  <div class="post-content"><p><img
    src="/portfolio/images/amanuensis-eeprom-interface/amanuensis_header.png#center" alt="Amanuensis Header Art"
    
     style="width: 100%; max-width: 700px;"
    /></p>
<hr>
<h2 id="what-is-it">What is it?<a hidden class="anchor" aria-hidden="true" href="#what-is-it">#</a></h2>
<p>A command-line tool to interact with a 28c256 256KB EEPROM, which is the one used in
<a href="https://www.youtube.com/watch?v=LnzuMJLZRdU&amp;list=PLowKtXNTBypFbtuVMUVXNR0z1mu7dp7eH&amp;index=1">Ben Eater&rsquo;s 6502 pc</a>.
Allows reading contents from the EEPROM and writing data to it.</p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/read_range_presentation.png#center" alt="Reading EEPROM preview"
    
     style="width: 100%; max-width: 700px;"
    /></p>
<blockquote>
<p><strong>Note:</strong> The command used to drive the EEPROM is<code>nuensis</code>. It is named after the Amanuensis monks, which provided services as scribes.</p>
</blockquote>
<p>Check the project on <a href="https://github.com/ignigoliz/amanuensis">Github</a> to make your own!</p>
<hr>
<h2 id="motivation">Motivation<a hidden class="anchor" aria-hidden="true" href="#motivation">#</a></h2>
<p>Some years ago I went down the rabbit hole of building an 8-bit pc after getting inspired by Ben Eater&rsquo;s Youtube videos.
The goal was to learn computer microarchitecture and to demistify the transition from logic gates to an <em>actual device</em> that runs computations.
It was very fun, and I plan to keep on playing with it in the near future.</p>
<p>However, I found the interaction with the EEPROM (the memory of the 8-bit pc) quite rough.
Ben Eater himself has a <a href="https://www.youtube.com/watch?v=K88pgWhEb1M">video</a> explaining how
to use an Arduino to write data to the EEPROM. Nonetheless, the Arduino code has to be changed
and re-uploaded with every new content one wants to write to the EEPROM.
I thought a Terminal-based interaction would make the experience so <em>muuuuuch</em> better.
So, <strong>I decided to build it</strong>.</p>
<blockquote>
<p><strong>Note:</strong> The core of the 8-bit pc is the 6502 microprocessor, a mythical chip that powered devices such as Apple II, NES, Commodore 64, and many others.</p>
</blockquote>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/eater_setup.png#center" alt="Ben&rsquo;s EEPROM programmer"
    
     style="width: 100%; max-width: 750px;"
    /></p>
<p>In particular, the reasons that make interacting with the EEPROM a painful process are the following:</p>
<ol>
<li>With every new EEPROM data, the Arduino script has to be updated and re-uploaded.</li>
<li>Likewise, when reading the EEPROM, selecting different addresses requires updating and re-uploading the Arduino code.</li>
<li>The Arduino pins must be connected to the EEPROM&rsquo;s pins thorugh 28 wires that have to be patiently and carefully placed. Also,
repeatedly plugging in and out the EEPROM for writing can end up damaging the EEPROM&rsquo;s pins.</li>
</ol>
<p>All this is annoying, specially considering that reading or writing the EEPROM is something that has to be done very frequently.</p>
<p>My solution:</p>
<ol>
<li>A CLI Tool to control the EEPROM using Terminal commands. One of the commands, <code>nuensis write --file program.bin</code>, writes a hexdump to the EEPROM.</li>
</ol>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/program.png#center" alt="Binary program contents"
    
     style="width: 100%; max-width: 700px;"
    /></p>
<ol start="2">
<li>Other commands allow reading the EEPROM. To read a range of addresses, <code>nuensis read --range 0000 003f</code>, which reads addresses <code>0x000</code> to <code>0x003f</code>. To read a single address, <code>nuensis read --address 002f</code>.</li>
</ol>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/nuensis_read_alone.gif#center" alt="Gif showing EEPROM reading"
    
     style="width: 100%; max-width: 700px;"
    /></p>
<ol start="3">
<li>The protoboard and the cables are replaced by a custom shield that is plugged directly into the Arduino Mega header.
Rather than plugging the chip and progressively damaging the pins, a ZIF (Zero Insertion Force) connector grips the EEPROM with delicacy.
<img
    src="/portfolio/images/amanuensis-eeprom-interface/shield_full.jpeg#center" alt="Closeup of the mounted shield"
    
     style="width: 100%; max-width: 500px;"
    /></li>
</ol>
<h2 id="how-it-works">How it Works<a hidden class="anchor" aria-hidden="true" href="#how-it-works">#</a></h2>
<p>The command parser for the Terminal runs in Python. Python communicates over the <em>Serial Port</em> with Arduino and sends what operation to perform.
Arduino executes the low level electric pulses and register conigurations that eventually read/write the EEPROM.</p>
<p>Each time a new command is submitted on the Terminal, a communication schema like the following takes place:</p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/schema_2.png#center" alt="Closeup of the mounted shield"
    
     style="width: 100%; max-width: 650px;"
    /></p>
<p>I decided to implement an acknowledgment-based communication structure to make sure that data was sent and received correctly.
After data is sent, the sender enters a halting state waiting for an acknowledgment (<code>ACK</code>) response. This applies to any sent data, except the ACK itself.</p>
<p>Besides this basic structure, the code has several optimizations. For example, when reading data, Arduino does not transfer it in single values but in batches of 16 bytes.</p>
<h2 id="serial-communication-python---arduino">Serial Communication Python - Arduino<a hidden class="anchor" aria-hidden="true" href="#serial-communication-python---arduino">#</a></h2>
<p>I use the Python <code>pyserial</code> library, and the built-in Arduino <code>Serial</code> library. Using serial communication in Python is not difficult but it&rsquo;s a bit slippery so I want to document the best practices I found.</p>
<p>When dealing with the EEPROM, everything is best thought in terms of <em>bytes</em>. Memory addesses are 2 bytes long and
each memory address stores data 1 byte long. Therefore, I need a way to <em>send byte-level information between Python and Arduino</em>.</p>
<blockquote>
<p><strong>Note:</strong> 1 byte can store numbers in the range 0-255. Using hex encoding, a byte is represented using 2 hex numbers.
<code>255 = 0xFF; 0 = 0x00; 58=0x3A</code>. Likewise, 4 hex numbers represent 2 bytes of information.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># PSEUDOCODE: The kind of communication desired:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Goal: Write data 0x00 to address 0x0407</span>
</span></span><span style="display:flex;"><span>package <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x00</span>, <span style="color:#ae81ff">0x04</span>, <span style="color:#ae81ff">0x07</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Send data from Python to Arduino</span>
</span></span><span style="display:flex;"><span>serial<span style="color:#f92672">.</span>send(package)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Arduino receives data and writes the EEPROM</span>
</span></span><span style="display:flex;"><span>package <span style="color:#f92672">=</span>  serial<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> package[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>address <span style="color:#f92672">=</span> combine(package[<span style="color:#ae81ff">1</span>], package[<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>eeprom<span style="color:#f92672">.</span>write(data, address)
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> I use <em>Big Endian</em> encoding: <code>0x0407 == [0x04, 0x07]</code>.</p>
</blockquote>
<h3 id="hex-arithmetics-in-arduino">Hex Arithmetics in Arduino<a hidden class="anchor" aria-hidden="true" href="#hex-arithmetics-in-arduino">#</a></h3>
<p>The Arduino programming language, which is based in C++, makes it easy to define byte-sized information:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> address <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x000f</span>;
</span></span><span style="display:flex;"><span>byte data <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xea</span>;
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> <code>byte</code> is exclusively an Arduino datatype; it&rsquo;s equivalent to <code>char</code> in C++,
or <code>std::byte</code> in C++17.</p>
</blockquote>
<p>Also, hex arithmetics behave intuitively in Arduino:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xabcd</span>; <span style="color:#75715e">// 0xABCD = 43981
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">==</span> <span style="color:#ae81ff">0xabcd</span>; <span style="color:#75715e">// True
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>x <span style="color:#f92672">==</span> <span style="color:#ae81ff">43981</span>; <span style="color:#75715e">// True
</span></span></span></code></pre></div><h3 id="hex-arithmetics-in-python">Hex Arithmetics in Python<a hidden class="anchor" aria-hidden="true" href="#hex-arithmetics-in-python">#</a></h3>
<p>Things get more challenging in Python. Python being by default a non-typed language makes it confusing to work with byte-level data directly in hex.</p>
<p>Python provides two classes to handle <strong>lists</strong> of byte data: <code>bytes()</code>, immutable; and <code>bytearray()</code>, mutable.</p>
<p>First, some features about the <code>bytes()</code> class. An instance of such an object can be</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xab</span><span style="color:#e6db74">&#39;</span>  <span style="color:#75715e"># 0xAB = 171</span>
</span></span><span style="display:flex;"><span>list(a)  <span style="color:#75715e"># prints [171]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xab\xcd</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>list(b)  <span style="color:#75715e"># prints [171, 205]</span>
</span></span></code></pre></div><p>So far so good. Feeling lucky. What will happen with the following&hellip;?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>c <span style="color:#f92672">=</span> list(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xab</span><span style="color:#e6db74">cd&#39;</span>)
</span></span><span style="display:flex;"><span>list(c)
</span></span></code></pre></div><p>Let&rsquo;s see&hellip;
<img
    src="/portfolio/images/amanuensis-eeprom-interface/bytes_weird.png#center" alt="Weird behaviour of bytes()"
    
     style="width: 100%; max-width: 500px;"
    /></p>
<p>Ehm&hellip; OK. That made me wink. Why 3 elements?</p>
<p>Well, it seems that Python, being <em>string-o-centric</em>, interprests the previous statement as &ldquo;Create a list of byte information with the contents &lsquo;0xab&rsquo;, &lsquo;c&rsquo;, and &rsquo;d&rsquo;&rdquo;. Then, it uses ASCII encoding for &lsquo;c&rsquo; (<code>c = ASCII 99</code>) and d (<code>d = ASCII 100</code>).</p>
<p>Why this behaviour? Well, it is because the <code>bytes()</code> object is not meant to behave nicely with HEX numbers. It is meant to store <em>byte strings</em>.</p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/bytes_strings.png#center" alt="Byte string vs normal string"
    
     style="width: 100%; max-width: 500px;"
    /></p>
<p>I&rsquo;d like to work with <code>bytes()</code> using a constructor like <code>some_magic_constructor('abcd')</code>. That way I could treat separately the bytes that compose an address, like <code>some_magic_constructor('ab' + 'cd')</code>.</p>
<p>Fortunately, there is <code>bytes.fromhex()</code> that does just that. And <code>.hex()</code> prints a its content as a hex string:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;ab&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;cd&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a<span style="color:#f92672">.</span>hex()  <span style="color:#75715e"># prints &#39;abcd&#39;</span>
</span></span></code></pre></div><p>The good thing about <code>bytes()</code> is that it allows list access to its elements. The bad thing is that it does not allow item assignment:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xab\xcd</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a[<span style="color:#ae81ff">0</span>]  <span style="color:#75715e"># prints 171 (0xab = 171)</span>
</span></span><span style="display:flex;"><span>a[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xef</span><span style="color:#e6db74">&#39;</span>  <span style="color:#75715e"># TypeError: &#39;bytes&#39; object does not support item assignment</span>
</span></span></code></pre></div><p>Fortunately, the class <code>bytearray()</code> behaves pretty much like <code>bytes()</code> but allows item assignment. It is instantiated by wrapping a <code>bytes()</code> object.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> byetearray(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xab\xcd</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> bytearray<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;ab&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;cd&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>b[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;ef&#39;</span>)  <span style="color:#75715e"># TypeError: &#39;bytes&#39; object cannot be interpreted as an integer</span>
</span></span><span style="display:flex;"><span>b[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">239</span>  <span style="color:#75715e"># 0xEF = 239</span>
</span></span></code></pre></div><p>The only problem is that its elements cannot be assigned directly to <code>bytes()</code>- Weird!. But that&rsquo;s a shortcoming I can live with.</p>
<h3 id="sending-information-over-serial-port">Sending information over Serial Port<a hidden class="anchor" aria-hidden="true" href="#sending-information-over-serial-port">#</a></h3>
<p>The Python <code>pyserial</code> library makes it straigthforward sending byte information over the Serial Port to Arduino:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>dev <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/dev/&#39;</span> <span style="color:#f92672">+</span> os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#34;ls /dev/ | grep cu.usbmodem&#34;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>rstrip()
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> serial<span style="color:#f92672">.</span>Serial(port<span style="color:#f92672">=</span>dev, baudrate<span style="color:#f92672">=</span><span style="color:#ae81ff">9600</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>packet <span style="color:#f92672">=</span> bytearray()
</span></span><span style="display:flex;"><span>packet <span style="color:#f92672">+=</span> bytearray<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;ab&#39;</span>)
</span></span><span style="display:flex;"><span>packet <span style="color:#f92672">+=</span> bytearray<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;cd&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>port<span style="color:#f92672">.</span>write(packet)
</span></span></code></pre></div><p>The Arduino is configured to just send back the data it receives:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> loop() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (Serial.available() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> incomingByte[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    Serial.readBytes(incomingByte, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    Serial.write(incomingByte, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The data that Arduino sends back gets stored in the serial buffer of the pc. Upon executing <code>port.read()</code>, the values are fetched one by one until the buffer is exhausted.</p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/write_data.gif#center" alt="Reading serial data"
    
     style="width: 100%; max-width: 500px;"
    /></p>
<h2 id="the-shield">The Shield<a hidden class="anchor" aria-hidden="true" href="#the-shield">#</a></h2>
<p>The shield simply connects certain Arduino Mega pins with certain EEPROM pins. The EEPROM is delicately held during programming using a ZIF connector (Zero Insertion Force). It also has a couple of LEDs for visual feedback.</p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/shield.png#center" alt="Closeup of the shield"
    
    
    /></p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/shield_mounted.jpeg#center" alt="Closeup of the shield"
    
     style="width: 100%; max-width: 400px;"
    /></p>
<p>I ordered a custom PCB for my shield, but you can also make your own, as I did for the first prototype:</p>
<p><img
    src="/portfolio/images/amanuensis-eeprom-interface/shield_prev.png#center" alt="Closeup of the first shield"
    
     style="width: 100%; max-width: 900px;"
    /></p>
<p><img
    src="https://komarev.com/ghpvc/?username=amanuensis-hugo&amp;style=pixel&amp;label=VISITOR&#43;COUNT" alt="Visitor Count"
    
    
    /></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://ignigoliz.github.io/portfolio/">Iñigo&#39;s Portfolio</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
